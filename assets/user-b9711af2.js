import{M as P,U as l,S as w,a as k}from"./main-20e5e0cf.js";import{S as I}from"./swiper-core-19160206.js";import{l as m}from"./index-64ae5ba6.js";import{A as E}from"./avatars-b957534f.js";import"./user_nav-b8e04adf.js";import"https://cdn.jsdelivr.net/npm/aos@2.3.4/+esm";const{VITE_BASEURL:A}={VITE_BASEURL:"https://triangle-golk-json-server.onrender.com",BASE_URL:"/Triangle_Golk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},s=document.getElementById("nickName"),v=document.querySelector("#edit-btn"),o=document.querySelector("#save-btn"),g=document.querySelector("#now-pwd"),p=document.querySelector("#set-newPwd"),b=document.querySelector("#re-pwd"),B=document.querySelector("#changePwdForm"),S=document.querySelector(".album"),q=document.querySelector("#success-message"),h=new P($("#pic-modal"));let a,f,c;async function N(){try{m(),a=await l.getUserInfo(),m(a),document.getElementById("nickName").value=a.nickName,document.getElementById("email").value=a.email,$(".user-avatar").attr("src",a.avatar.image),c=a.avatarId,f=await E.getTotal(),T(f)}catch{m()}}N();function T(e){const i=a.avatars.map(t=>e.find(r=>r.id===t));S.innerHTML=`
    <div class="row g-4">
    ${i.map(t=>`
    <div class="col-lg-4 col-6">
        <button class="btn p-0 ${a.avatarId===t.id?"albumPic-active":""}" type="button">
        <img data-id="${t.id}" class="avatar-img" src="${t.image}" alt="${t.name}-${t.level}" />
        </button>
    </div>`).join("")}
    </div>
    `}v.addEventListener("click",function(e){s.removeAttribute("readonly"),s.focus(),v.classList.add("d-none"),o.classList.remove("d-none"),o.classList.remove("btn-secondary"),o.classList.add("btn-outline-secondary")});o.addEventListener("click",function(e){s.value=s.value.trim(),s.value!==a.nickName&&l.updateUser({nickName:s.value}),s.setAttribute("readonly",!0),o.classList.add("d-none"),v.classList.remove("d-none")});$(".pic-modal-btn").click(()=>h.show());S.addEventListener("click",e=>{document.querySelectorAll(".avatar-img").forEach(t=>{t.parentElement.classList.remove("albumPic-active"),t.classList.remove("opacity-100")}),e.target.parentElement.classList.add("albumPic-active"),e.target.classList.add("opacity-100"),c=Number(e.target.dataset.id)});q.addEventListener("click",function(){c===a.avatarId?w.fire({scrollbarPadding:!1,icon:"success",title:"頭像變更成功",showConfirmButton:!1,timer:1500}):(E.setAvatar(c),$(".user-avatar").attr("src",f.find(e=>e.id===c).image)),h.hide()});const L=new I(".swiper-container",{initialSlide:0,navigation:{nextEl:"#changePwd-btn",prevEl:".swiper-prev-btn"},allowTouchMove:!1,spaceBetween:20});$("#changePwd-btn").click(()=>L.slideNext());$("#prev-btn").click(()=>L.slidePrev());B.addEventListener("submit",async e=>{e.preventDefault();const i=g.value.trim(),t=p.value.trim(),r=b.value.trim();let n=u(g);if(n=u(p),n=u(b),!n){if(t!==r){y("密碼不一致");return}try{await k.post(`${A}/login`,{email:a.email,password:i}),l.updateUser({password:r},!0);const d=await w.fire({scrollbarPadding:!1,icon:"success",title:"變更密碼成功, 請重新登入",showConfirmButton:!1,timer:1500});(d.isDismissed||d.isConfirmed)&&(l.clearUserInfo(),location.href="index.html")}catch{y("當前密碼錯誤")}}});function u(e,i){const r=e.parentElement.querySelector(".invalid-feedback"),n=e.value.trim();return n||(r.innerText="欄位不得為空"),n&&n.length<6&&(r.innerText="密碼至少需要6個字元"),!n||n.length<6}function y(e){w.fire({scrollbarPadding:!1,icon:"error",title:e})}
