import{U as T}from"./main-6c126296.js";import"https://unpkg.com/@wangeditor/editor@latest/dist/index.js";import{C as m}from"./comment-a44fa049.js";import{C as x}from"./course-0f83fb1f.js";import"https://cdn.jsdelivr.net/npm/aos@2.3.4/+esm";import"./avatars-cf792582.js";const H=document.querySelector("#curr-course"),s=document.querySelector("#comment-form"),A=document.querySelector(".stars-icon"),u=A.querySelectorAll(".material-symbols-outlined"),y=document.querySelector(".comment-content"),i=document.querySelector(".comment-view"),l=document.querySelector(".prove-img"),g=document.querySelector(".comment-userName"),f=document.querySelector(".page-title"),n=new URLSearchParams(window.location.search),h=n.has("id")&&n.get("id"),b=n.has("courseId")&&n.get("courseId");let t={courseId:b,isPassed:-1,failContent:"",canEdit:!0,theme:0,likes:[],likesNum:0,showName:1},p;const c={nickName:"",email:""};async function M(){if(h){const e=await m.getCurrent(h);f.textContent=`完課評價－${e.course.title}`,t={...t,...e},c.nickName=e.user.nickName,c.email=e.user.email.slice(0,e.user.email.indexOf("@")),s["course-img"].value=t.image,s["public-name"].value=t.showName,N(t.score),d(),y.innerHTML=t.content,C.setHtml(t.content),s["comment-style"].value=t.theme,L(t.course)}else{const e=await T.getUserInfo();c.nickName=e.nickName,c.email=e.email.slice(0,e.email.indexOf("@")),i.classList.add(`comment-style${t.theme}`);try{const o=await x.getCourse(b);f.textContent=`完課評價－${o.title}`,L(o)}catch{location.href="user_courses.html"}}S(t.showName),w(t.image),i.classList.add(`comment-style${t.theme}`)}M();function L(e){H.innerHTML=`
  <div class="row g-0">
  <div class="col-5 col-lg-4 card-row">
    <img src="${e.cover}" class="img-fluid rounded-start"
      alt="${e.title}">
  </div>
  <div class="col-7 col-lg-8">
    <div class="card-body">
      <h4 class="card-title text-truncate">${e.title}</h4>
    </div>
    <div class="card-footer">
    <div class="tags mb-2 mt-auto">
    ${e.tags.map(o=>`<span class="fs-8 me-2">#${o}</span>`).join("")}
      </div>
    </div>
  </div>
</div>`}function w(e=""){e?(l.classList.remove("d-none"),l.setAttribute("src",e)):l.classList.add("d-none")}s["course-img"].addEventListener("change",e=>w(e.target.value));s["public-name"].forEach(e=>{e.addEventListener("change",o=>S(o.target.value))});function S(e){Number(e)?g.innerHTML=`${c.nickName}：`:g.innerHTML=c.email?`${c.email[0]}***${c.email[c.email.length-1]}：`:"："}u.forEach(e=>{e.addEventListener("click",o=>{t.score=o.target.getAttribute("value"),d(o),N(t.score)}),e.addEventListener("mouseenter",d),e.addEventListener("mouseleave",()=>{t.score||u.forEach(o=>{o.classList.add("outline-icon")})})});function d(e){const o=t.score||e.target.getAttribute("value");u.forEach(r=>{r.classList.add("outline-icon"),r.getAttribute("value")<=o&&r.classList.remove("outline-icon")})}function N(e){document.querySelector(".comment-scores").querySelectorAll(".material-symbols-outlined").forEach(r=>{r.classList.add("outline-icon"),r.getAttribute("value")<=e&&r.classList.remove("outline-icon")})}s["comment-style"].forEach(e=>{e.addEventListener("click",o=>{i.classList.remove("comment-style1"),i.classList.remove("comment-style0"),i.classList.add(`comment-style${o.target.value}`)})});s.addEventListener("submit",e=>{e.preventDefault(),t.image=s["course-img"].value,t.showName=s["public-name"].value,t.theme=s["comment-style"].value,s["course-img"].classList.remove("is-invalid"),s.querySelector(".course-scores").classList.remove("is-invalid"),s.querySelector(".course-content").classList.remove("is-invalid"),t.image||s["course-img"].classList.add("is-invalid"),t.score||(s.querySelector(".course-scores").classList.add("is-invalid"),s.querySelector(".course-scores").classList.add("fw-bold")),p.trim().length||(s.querySelector(".course-content").classList.add("is-invalid"),s.querySelector(".course-content").classList.add("fw-bold"));const o=s.querySelector(".is-invalid");if(o&&(o.focus(),window.scrollTo({top:o.offsetTop-100})),o)return;const{courseId:r,showName:q,score:E,theme:$,image:k,content:I,likes:v}=t,a={courseId:Number(r),canEdit:!0,image:k,showName:Number(q),score:Number(E),content:I,theme:Number($),isPassed:-1,failContent:"",likes:v,likesNum:v.length,timer:new Date().getTime(),userId:Number(localStorage.getItem("userId"))};t.id?(a.canEdit=!1,m.editorComment(t.id,a)):m.addComment(a)});const{createEditor:P,createToolbar:U}=window.wangEditor,D={placeholder:"最多不超過 100 字",maxLength:100,onChange(e){const o=e.getHtml();p=e.getText(),y.innerHTML=o.replace(/<p><br><\/p>/g,""),t.content=o}},C=P({selector:"#editor-container",html:"<p><br></p>",config:D,mode:"simple"}),O={toolbarKeys:["bold","underline","italic","|","undo","redo"]};U({editor:C,selector:"#toolbar-container",config:O,mode:"default"});
