import{a as d,S as w,U as v}from"./main-20e5e0cf.js";import"https://cdn.jsdelivr.net/npm/aos@2.3.4/+esm";const{VITE_BASEURL:h}={VITE_BASEURL:"https://triangle-golk-json-server.onrender.com",BASE_URL:"/Triangle_Golk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},b={async curCourse(){try{const a=new URLSearchParams(window.location.search),l=a.has("courseId")&&a.get("courseId");return(await d.get(`${h}/chatRooms?courseId=${l}&_expand=course`)).data}catch(a){console.log(a)}},async update(a,l){try{const e=await d.get(`${h}/users/${localStorage.getItem("userId")}`);await d.patch(`${h}/chatRooms/${l}`,a);const{totalCheckIn:c,avatars:n,checkInTimer:t}=e.data;if(new Date(t).toLocaleDateString()!==new Date(new Date).toLocaleDateString()){const o=c+1;o>=90?!n.includes(8)&&n.push(8):o>=30?!n.includes(7)&&n.push(7):o>=7&&!n.includes(6)&&n.push(6),[90,30,7].includes(o)&&w.fire({scrollbarPadding:!1,title:`恭喜您已簽到${o}天, 獲得新徽章`,showConfirmButton:!1,timer:2500,allowOutsideClick:!1});const s={totalCheckIn:o,checkInTimer:new Date().getTime(),avatars:n};await d.patch(`${h}/users/${localStorage.getItem("userId")}`,s)}return await this.curCourse()}catch(e){console.log(e)}}},x=function(a,l){var e,c,n,t,o;function s(i){i.preventDefault(),e.hide("scale"),c.show("scale")}function g(i){i.preventDefault(),e.show("scale"),c.hide("scale")}function p(i){i.preventDefault()}function u(){e=$("#chat-circle"),c=$(".chat-box"),n=$(".chat-box-toggle"),$(".chat-box-welcome__header"),$("#chat-box__wraper"),o=$("#chat-input__text"),t=$("#chat-submit"),e.on("click",s),n.on("click",g),o.on("click",p),t.on("click"),o.on("keypress")}return{init:u}}();$(document).ready(x.init);let r,m;async function I(){r=await b.curCourse();const{platform:a,title:l,id:e}=r[0].course;$(".page-platform").html(a),$(".page-title").html(l),$(".page-back").attr("href",`coursepages.html?id=${e}&sort=timer`),$("#dropdown-menu-link").html(`教室：${r[0].name}`),$(".room-list").html(r.map(c=>`
    <li data-total="${c.total}" class="dropdown-item">教室：${c.name}</li>
    `).join("")),f(r[0].total,r)}I();function f(a,l){m=$("#dropdown-menu-link").text().split("：")[1];const{onlineUsers:e=[]}=l.find(t=>t.name===m),c=Math.round(a/3);let n="";for(let t=1;t<=c;t++)n+=`<li class="triangle col-lg-3 col-md-5 col-12 d-flex flex-column text-center text-center">
            <div class="col-auto triangle-container d-flex justify-content-center align-items-center col-auto">
                <span data-table="${t}-1" class="triangle-two col-auto ${e.find(o=>o.site===`${t}-1`)?"active":""}"></span>
                <span data-table="${t}-2" class="triangle-three col-auto ${e.find(o=>o.site===`${t}-2`)?"active":""}"></span>
                <span data-table="${t}-3" class="triangle-four col-auto ${e.find(o=>o.site===`${t}-3`)?"active":""}"></span>
            </div>
        </li>`;$(".page-table").html(n)}$(".page-table").click(async a=>{const{table:l}=a.target.dataset;if(!l||a.target.classList.contains("active"))return;const{onlineUsers:e=[],total:c,id:n}=r.find(s=>s.name===m),t=Number(localStorage.getItem("userId")),o=e.find(s=>s.userId===t);o?o.site=l:e.push({site:l,userId:t}),f(c,r),await b.update({onlineUsers:e},n)});$(".room-list").click(a=>{a.target.dataset.total&&($("#dropdown-menu-link").html(a.target.textContent),f(a.target.dataset.total,r))});$(".level-class").click(async a=>{a.preventDefault();const{onlineUsers:l=[],id:e,total:c}=r.find(t=>t.name===m),n=l.filter(t=>t.userId!==Number(localStorage.getItem("userId")));f(c,await b.update({onlineUsers:n},e)),location.href=$(".page-back").attr("href")});const k=function(a,l){var e,c,n;function t(){var s=c.val(),g=n.avatar.image,p='<div class="chat-msg self chat-msg bot"><span class="msg-avatar"><img class="chat-box-overlay_robot rounded-circle" src="'+g+'" alt="用戶頭像"></span><span class="cm-msg-text shadow-sm rounded text-secondary fw-bold bg-light" style="float:left;" >'+s+"</span></div>";$(".chat-logs").append(p);var u=$(".chat-logs")[0];u.scrollTop=u.scrollHeight,c.val("")}function o(){$("#chat-circle"),$(".chat-box"),$(".chat-box-toggle"),$(".chat-box-welcome__header"),$("#chat-box__wraper"),c=$("#chat-input__text"),e=$("#chat-submit"),$("#chat-box-username"),$("#chat-box-avatar"),v.getUserInfo().then(function(s){s&&(n=s)}).catch(function(s){console.error(s)}),e.on("click",function(s){s.preventDefault(),t()}),c.on("keypress",function(s){(s.keyCode===13||s.which===13)&&(s.preventDefault(),t())})}return{init:o}}();$(document).ready(k.init);setTimeout(function(){document.getElementById("chat-box__wraper").style.display="block"},0);
