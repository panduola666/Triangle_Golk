import{U as $}from"./footer-b5e551b8.js";import"https://unpkg.com/@wangeditor/editor@latest/dist/index.js";import{C as m}from"./comment-ec1c430b.js";import{C as T}from"./course-944b0619.js";const H=document.querySelector("#curr-course"),o=document.querySelector("#comment-form"),A=document.querySelector(".stars-icon"),u=A.querySelectorAll(".material-symbols-outlined"),L=document.querySelector(".comment-content"),i=document.querySelector(".comment-view"),l=document.querySelector(".prove-img"),g=document.querySelector(".comment-userName"),n=new URLSearchParams(window.location.search),f=n.has("id")&&n.get("id"),y=n.has("courseId")&&n.get("courseId");let t={courseId:y,isPassed:-1,failContent:"",canEdit:!0,theme:0,likes:[],likesNum:0,showName:1},b;const c={nickName:"",email:""};async function x(){if(f){const e=await m.getCurrent(f);t={...t,...e},c.nickName=e.user.nickName,c.email=e.user.email.slice(0,e.user.email.indexOf("@")),o["course-img"].value=t.image,o["public-name"].value=t.showName,N(t.score),d(),L.innerHTML=t.content,S.setHtml(t.content),o["comment-style"].value=t.theme,h(t.course)}else{const e=await $.getUserInfo();c.nickName=e.nickName,c.email=e.email.slice(0,e.email.indexOf("@")),i.classList.add(`comment-style${t.theme}`);try{const s=await T.getCourse(y);h(s)}catch{location.href="/pages/user_courses.html"}}p(t.showName),w(t.image),i.classList.add(`comment-style${t.theme}`)}x();function h(e){H.innerHTML=`
  <div class="row g-0">
  <div class="col-5 col-lg-4 card-row">
    <img src="${e.cover}" class="img-fluid rounded-start"
      alt="${e.title}">
  </div>
  <div class="col">
    <div class="card-body">
      <h4 class="card-title text-truncate">${e.title}</h4>
    </div>
    <div class="card-footer">
    <div class="tags mb-2 mt-auto">
    ${e.tags.map(s=>`<span class="fs-8 me-2">#${s}</span>`).join("")}
      </div>
    </div>
  </div>
</div>`}function w(e=""){e?(l.classList.remove("d-none"),l.setAttribute("src",e)):l.classList.add("d-none")}o["course-img"].addEventListener("change",e=>w(e.target.value));o["public-name"].forEach(e=>{e.addEventListener("change",s=>p(s.target.value))});function p(e){Number(e)?g.innerHTML=`${c.nickName}：`:g.innerHTML=c.email?`${c.email[0]}***${c.email[c.email.length-1]}：`:"："}u.forEach(e=>{e.addEventListener("click",s=>{t.score=s.target.getAttribute("value"),d(s),N(t.score)}),e.addEventListener("mouseenter",d),e.addEventListener("mouseleave",()=>{t.score||u.forEach(s=>{s.classList.add("outline-icon")})})});function d(e){const s=t.score||e.target.getAttribute("value");u.forEach(r=>{r.classList.add("outline-icon"),r.getAttribute("value")<=s&&r.classList.remove("outline-icon")})}function N(e){document.querySelector(".comment-scores").querySelectorAll(".material-symbols-outlined").forEach(r=>{r.classList.add("outline-icon"),r.getAttribute("value")<=e&&r.classList.remove("outline-icon")})}o["comment-style"].forEach(e=>{e.addEventListener("click",s=>{i.classList.remove("comment-style1"),i.classList.remove("comment-style0"),i.classList.add(`comment-style${s.target.value}`)})});o.addEventListener("submit",e=>{e.preventDefault(),t.image=o["course-img"].value,t.showName=o["public-name"].value,t.theme=o["comment-style"].value,o["course-img"].classList.remove("is-invalid"),o.querySelector(".course-scores").classList.remove("is-invalid"),o.querySelector(".course-content").classList.remove("is-invalid"),t.image||o["course-img"].classList.add("is-invalid"),t.score||(o.querySelector(".course-scores").classList.add("is-invalid"),o.querySelector(".course-scores").classList.add("fw-bold")),b.trim().length||(o.querySelector(".course-content").classList.add("is-invalid"),o.querySelector(".course-content").classList.add("fw-bold"));const s=o.querySelector(".is-invalid");if(s&&(s.focus(),window.scrollTo({top:s.offsetTop-100})),s)return;const{courseId:r,showName:E,score:q,theme:C,image:k,content:I,likes:v}=t,a={courseId:Number(r),canEdit:!0,image:k,showName:Number(E),score:Number(q),content:I,theme:Number(C),isPassed:-1,failContent:"",likes:v,likesNum:v.length,timer:new Date().getTime(),userId:Number(localStorage.getItem("userId"))};t.id?(a.canEdit=!1,m.editorComment(t.id,a)):m.addComment(a)});const{createEditor:M,createToolbar:P}=window.wangEditor,U={placeholder:"最多不超過 100 字",maxLength:100,onChange(e){const s=e.getHtml();b=e.getText(),L.innerHTML=s.replace(/<p><br><\/p>/g,""),t.content=s}},S=M({selector:"#editor-container",html:"<p><br></p>",config:U,mode:"simple"}),D={toolbarKeys:["bold","underline","italic","|","undo","redo"]};P({editor:S,selector:"#toolbar-container",config:D,mode:"default"});
