import{a as d,S as w,U as v}from"./main-6c126296.js";import"https://cdn.jsdelivr.net/npm/aos@2.3.4/+esm";const{VITE_BASEURL:h}={VITE_BASEURL:"https://triangle-golk-json-server.onrender.com",BASE_URL:"/Triangle_Golk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},b={async curCourse(){try{const o=new URLSearchParams(window.location.search),s=o.has("courseId")&&o.get("courseId");return(await d.get(`${h}/chatRooms?courseId=${s}&_expand=course`)).data}catch(o){console.log(o)}},async update(o,s){try{const e=await d.get(`${h}/users/${localStorage.getItem("userId")}`);await d.patch(`${h}/chatRooms/${s}`,o);const{totalCheckIn:c,avatars:n,checkInTimer:t}=e.data;if(new Date(t).toLocaleDateString()!==new Date(new Date).toLocaleDateString()){const a=c+1;a>=90?!n.includes(8)&&n.push(8):a>=30?!n.includes(7)&&n.push(7):a>=7&&!n.includes(6)&&n.push(6),[90,30,7].includes(a)&&w.fire({scrollbarPadding:!1,title:`恭喜您已簽到${a}天, 獲得新徽章`,showConfirmButton:!1,timer:2500,allowOutsideClick:!1});const i={totalCheckIn:a,checkInTimer:new Date().getTime(),avatars:n};await d.patch(`${h}/users/${localStorage.getItem("userId")}`,i)}return await this.curCourse()}catch(e){console.log(e)}}},x=function(o,s){var e,c,n,t,a;function i(u){u.preventDefault(),e.hide("scale"),c.show("scale")}function r(u){u.preventDefault(),e.show("scale"),c.hide("scale")}function g(u){u.preventDefault()}function p(){e=$("#chat-circle"),c=$(".chat-box"),n=$(".chat-box-toggle"),$(".chat-box-welcome__header"),$("#chat-box__wraper"),a=$("#chat-input__text"),t=$("#chat-submit"),e.on("click",i),n.on("click",r),a.on("click",g),t.on("click"),a.on("keypress")}return{init:p}}();$(document).ready(x.init);let l,m;async function k(){l=await b.curCourse();const{platform:o,title:s,id:e}=l[0].course;$(".page-platform").html(o),$(".page-title").html(s),$(".page-back").attr("href",`coursepages.html?id=${e}&sort=timer`),$("#dropdown-menu-link").html(`教室：${l[0].name}`),$(".room-list").html(l.map(c=>`
    <li data-total="${c.total}" class="dropdown-item">教室：${c.name}</li>
    `).join("")),f(l[0].total,l)}k();function f(o,s){m=$("#dropdown-menu-link").text().split("：")[1];const{onlineUsers:e=[]}=s.find(t=>t.name===m),c=Math.round(o/3);let n="";for(let t=1;t<=c;t++)n+=`<li class="triangle col-lg-3 col-md-5 col-12 d-flex flex-column text-center text-center">
            <div class="col-auto triangle-container d-flex justify-content-center align-items-center col-auto">
                <span data-table="${t}-1" class="triangle-two col-auto ${e.find(a=>a.site===`${t}-1`)?"active":""}"></span>
                <span data-table="${t}-2" class="triangle-three col-auto ${e.find(a=>a.site===`${t}-2`)?"active":""}"></span>
                <span data-table="${t}-3" class="triangle-four col-auto ${e.find(a=>a.site===`${t}-3`)?"active":""}"></span>
            </div>
        </li>`;$(".page-table").html(n)}$(".page-table").click(async o=>{const{table:s}=o.target.dataset;if(!s||o.target.classList.contains("active"))return;const{onlineUsers:e=[],total:c,id:n}=l.find(i=>i.name===m),t=Number(localStorage.getItem("userId")),a=e.find(i=>i.userId===t);a?a.site=s:e.push({site:s,userId:t}),f(c,l),await b.update({onlineUsers:e},n)});$(".room-list").click(o=>{o.target.dataset.total&&($("#dropdown-menu-link").html(o.target.textContent),f(o.target.dataset.total,l))});$(".level-class").click(async o=>{o.preventDefault();const{onlineUsers:s=[],id:e,total:c}=l.find(t=>t.name===m),n=s.filter(t=>t.userId!==Number(localStorage.getItem("userId")));f(c,await b.update({onlineUsers:n},e)),location.href=$(".page-back").attr("href")});const I=function(o,s){var e,c,n,t;function a(){var r=c.val(),g=t.avatar.image,p='<div class="chat-msg self chat-msg bot"><span class="msg-avatar"><img class="chat-box-overlay_robot rounded-circle" src="'+g+'" alt="用戶頭像"></span><span class="cm-msg-text shadow-sm rounded text-secondary fw-bold bg-light" style="float:left;" >'+r+"</span></div>";$(".chat-logs").append(p);var u=$(".chat-logs")[0];u.scrollTop=u.scrollHeight,c.val("")}function i(){$("#chat-circle"),$(".chat-box"),$(".chat-box-toggle"),$(".chat-box-welcome__header"),$("#chat-box__wraper"),c=$("#chat-input__text"),e=$("#chat-submit"),n=$("#chat-box-username"),$("#chat-box-avatar"),v.getUserInfo().then(function(r){r&&(t=r,n.text(t.nickName))}).catch(function(r){console.error(r)}),e.on("click",function(r){r.preventDefault(),a()}),c.on("keypress",function(r){(r.keyCode===13||r.which===13)&&(r.preventDefault(),a())})}return{init:i}}();$(document).ready(I.init);setTimeout(function(){document.getElementById("chat-box__wraper").style.display="block"},0);
